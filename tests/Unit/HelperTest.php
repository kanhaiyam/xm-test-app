<?php

namespace Tests\Unit;

use Tests\TestCase;
use App\Helpers\Helper;
use App\Models\Symbol;

class HelperTest extends TestCase
{
    /**
     * A basic unit test example.
     */
    public function test_example(): void
    {
        $this->assertTrue(true);
    }

    public function test_prepare_mail_contents_works(): void
    {
        $symbol = new Symbol([
            'id' => 'ee6b7271-f563-4769-a267-daa81c980b5a',
            'c_name' => 'Apple Inc.',
            's_name' => 'Apple Inc. - Common Share',
            'symbol' => 'APPL',
            'f_status' => 'N',
            'm_category' => 'Q',
            'lot_size' => 100.0,
            'is_test' => 'N',
            'updated_at' => '2023-04-21 14:26:47'
        ]);

        $formInput = ['s_date' => 1672842600, 'e_date' => 1677249000];
        $response = Helper::prepareMailContents($symbol, $formInput);

        $this->assertNotEmpty($response);
        $this->assertIsArray($response);
        $this->assertArrayHasKey('body', $response);
        $this->assertArrayHasKey('subject', $response);
        $this->assertNotEmpty($response['body']);
        $this->assertIsString($response['body']);
        $this->assertNotEmpty($response['subject']);
        $this->assertIsString($response['subject']);
    }

    public function test_format_data_for_table_function(): void
    {
        $inputData = '{"prices":[{"date":1681997400,"open":1.3899999856948853,"high":1.399999976158142,"low":1.350000023841858,"close":1.3600000143051147,"volume":1476000,"adjclose":1.3600000143051147},{"date":1681911000,"open":1.3600000143051147,"high":1.399999976158142,"low":1.350000023841858,"close":1.399999976158142,"volume":2326100,"adjclose":1.399999976158142},{"date":1681824600,"open":1.399999976158142,"high":1.4199999570846558,"low":1.3700000047683716,"close":1.3700000047683716,"volume":2159200,"adjclose":1.3700000047683716},{"date":1681738200,"open":1.350000023841858,"high":1.399999976158142,"low":1.3300000429153442,"close":1.3899999856948853,"volume":2318700,"adjclose":1.3899999856948853},{"date":1681479000,"open":1.3899999856948853,"high":1.399999976158142,"low":1.350000023841858,"close":1.350000023841858,"volume":1343800,"adjclose":1.350000023841858},{"date":1681392600,"open":1.3600000143051147,"high":1.4299999475479126,"low":1.3600000143051147,"close":1.409999966621399,"volume":4492200,"adjclose":1.409999966621399},{"date":1681306200,"open":1.4199999570846558,"high":1.440000057220459,"low":1.350000023841858,"close":1.3600000143051147,"volume":1459400,"adjclose":1.3600000143051147},{"date":1681219800,"open":1.3799999952316284,"high":1.4600000381469727,"low":1.3600000143051147,"close":1.4199999570846558,"volume":1733200,"adjclose":1.4199999570846558},{"date":1681133400,"open":1.350000023841858,"high":1.399999976158142,"low":1.3300000429153442,"close":1.3799999952316284,"volume":1135300,"adjclose":1.3799999952316284},{"date":1680787800,"open":1.3600000143051147,"high":1.3799999952316284,"low":1.3200000524520874,"close":1.3700000047683716,"volume":1917800,"adjclose":1.3700000047683716},{"date":1680701400,"open":1.409999966621399,"high":1.4299999475479126,"low":1.340000033378601,"close":1.3700000047683716,"volume":1958300,"adjclose":1.3700000047683716},{"date":1680615000,"open":1.4800000190734863,"high":1.5,"low":1.409999966621399,"close":1.4299999475479126,"volume":7939300,"adjclose":1.4299999475479126},{"date":1680528600,"open":1.4800000190734863,"high":1.5,"low":1.4299999475479126,"close":1.4900000095367432,"volume":2728300,"adjclose":1.4900000095367432},{"date":1680269400,"open":1.5499999523162842,"high":1.5499999523162842,"low":1.4199999570846558,"close":1.5,"volume":4744800,"adjclose":1.5},{"date":1680183000,"open":1.5499999523162842,"high":1.5499999523162842,"low":1.4700000286102295,"close":1.5399999618530273,"volume":2291500,"adjclose":1.5399999618530273},{"date":1680096600,"open":1.5299999713897705,"high":1.559999942779541,"low":1.5199999809265137,"close":1.5399999618530273,"volume":1482900,"adjclose":1.5399999618530273},{"date":1680010200,"open":1.5199999809265137,"high":1.5800000429153442,"low":1.5199999809265137,"close":1.5299999713897705,"volume":3113700,"adjclose":1.5299999713897705},{"date":1679923800,"open":1.5199999809265137,"high":1.559999942779541,"low":1.5099999904632568,"close":1.5299999713897705,"volume":3004200,"adjclose":1.5299999713897705},{"date":1679664600,"open":1.5,"high":1.5299999713897705,"low":1.4800000190734863,"close":1.5299999713897705,"volume":2176300,"adjclose":1.5299999713897705},{"date":1679578200,"open":1.559999942779541,"high":1.590000033378601,"low":1.5199999809265137,"close":1.5199999809265137,"volume":1623500,"adjclose":1.5199999809265137},{"date":1679491800,"open":1.6399999856948853,"high":1.6399999856948853,"low":1.5299999713897705,"close":1.5299999713897705,"volume":2389800,"adjclose":1.5299999713897705},{"date":1679405400,"open":1.6100000143051147,"high":1.659999966621399,"low":1.5700000524520874,"close":1.6200000047683716,"volume":3387300,"adjclose":1.6200000047683716},{"date":1679319000,"open":1.5399999618530273,"high":1.6399999856948853,"low":1.5199999809265137,"close":1.5700000524520874,"volume":3710700,"adjclose":1.5700000524520874},{"date":1679059800,"open":1.6299999952316284,"high":1.6299999952316284,"low":1.5399999618530273,"close":1.5399999618530273,"volume":1694700,"adjclose":1.5399999618530273},{"date":1678973400,"open":1.5199999809265137,"high":1.659999966621399,"low":1.4700000286102295,"close":1.6299999952316284,"volume":4563100,"adjclose":1.6299999952316284},{"date":1678887000,"open":1.5700000524520874,"high":1.5700000524520874,"low":1.4600000381469727,"close":1.5199999809265137,"volume":4797500,"adjclose":1.5199999809265137},{"date":1678800600,"open":1.6299999952316284,"high":1.6399999856948853,"low":1.5299999713897705,"close":1.5800000429153442,"volume":8011400,"adjclose":1.5800000429153442},{"date":1678714200,"open":1.590000033378601,"high":1.6200000047683716,"low":1.5399999618530273,"close":1.5499999523162842,"volume":3340500,"adjclose":1.5499999523162842},{"date":1678458600,"open":1.7200000286102295,"high":1.7400000095367432,"low":1.5199999809265137,"close":1.590000033378601,"volume":8093500,"adjclose":1.590000033378601},{"date":1678372200,"open":1.8300000429153442,"high":1.8600000143051147,"low":1.7100000381469727,"close":1.7100000381469727,"volume":4020500,"adjclose":1.7100000381469727},{"date":1678285800,"open":1.850000023841858,"high":1.9199999570846558,"low":1.809999942779541,"close":1.8300000429153442,"volume":2911600,"adjclose":1.8300000429153442},{"date":1678199400,"open":1.8799999952316284,"high":1.9299999475479126,"low":1.8200000524520874,"close":1.8200000524520874,"volume":2962400,"adjclose":1.8200000524520874},{"date":1678113000,"open":1.9700000286102295,"high":1.9700000286102295,"low":1.7899999618530273,"close":1.8600000143051147,"volume":5195200,"adjclose":1.8600000143051147},{"date":1677853800,"open":1.9199999570846558,"high":1.9800000190734863,"low":1.909999966621399,"close":1.9500000476837158,"volume":1530600,"adjclose":1.9500000476837158},{"date":1677767400,"open":2.049999952316284,"high":2.0999999046325684,"low":1.850000023841858,"close":1.9500000476837158,"volume":6574100,"adjclose":1.9500000476837158},{"date":1677681000,"open":2,"high":2.130000114440918,"low":1.9700000286102295,"close":2.059999942779541,"volume":4840600,"adjclose":2.059999942779541},{"date":1677594600,"open":1.840000033378601,"high":2.1700000762939453,"low":1.7000000476837158,"close":2.0299999713897705,"volume":18472400,"adjclose":2.0299999713897705},{"date":1677508200,"open":1.7999999523162842,"high":1.8700000047683716,"low":1.7899999618530273,"close":1.840000033378601,"volume":1946600,"adjclose":1.840000033378601},{"date":1677249000,"open":1.7899999618530273,"high":1.8200000524520874,"low":1.7200000286102295,"close":1.7699999809265137,"volume":2518100,"adjclose":1.7699999809265137},{"date":1677162600,"open":1.8200000524520874,"high":1.8300000429153442,"low":1.75,"close":1.8200000524520874,"volume":3907100,"adjclose":1.8200000524520874},{"date":1677076200,"open":1.8300000429153442,"high":1.840000033378601,"low":1.7599999904632568,"close":1.8200000524520874,"volume":1521300,"adjclose":1.8200000524520874},{"date":1676989800,"open":1.8200000524520874,"high":1.850000023841858,"low":1.7699999809265137,"close":1.7999999523162842,"volume":3023900,"adjclose":1.7999999523162842},{"date":1676644200,"open":1.8799999952316284,"high":1.8799999952316284,"low":1.7899999618530273,"close":1.840000033378601,"volume":2613500,"adjclose":1.840000033378601},{"date":1676557800,"open":1.9199999570846558,"high":1.9299999475479126,"low":1.850000023841858,"close":1.8700000047683716,"volume":3725100,"adjclose":1.8700000047683716},{"date":1676471400,"open":1.9500000476837158,"high":1.9500000476837158,"low":1.8899999856948853,"close":1.899999976158142,"volume":2365100,"adjclose":1.899999976158142},{"date":1676385000,"open":1.9199999570846558,"high":1.9700000286102295,"low":1.899999976158142,"close":1.9600000381469727,"volume":1711500,"adjclose":1.9600000381469727},{"date":1676298600,"open":1.9800000190734863,"high":1.9800000190734863,"low":1.899999976158142,"close":1.9600000381469727,"volume":2276400,"adjclose":1.9600000381469727},{"date":1676039400,"open":2.0399999618530273,"high":2.0399999618530273,"low":1.8799999952316284,"close":1.9199999570846558,"volume":3175500,"adjclose":1.9199999570846558},{"date":1675953000,"open":2.049999952316284,"high":2.119999885559082,"low":2,"close":2,"volume":3708100,"adjclose":2},{"date":1675866600,"open":2.2100000381469727,"high":2.2300000190734863,"low":2,"close":2.009999990463257,"volume":6850400,"adjclose":2.009999990463257},{"date":1675780200,"open":1.9900000095367432,"high":2.190000057220459,"low":1.9600000381469727,"close":2.190000057220459,"volume":11035700,"adjclose":2.190000057220459},{"date":1675693800,"open":1.8899999856948853,"high":1.9700000286102295,"low":1.8799999952316284,"close":1.940000057220459,"volume":3538400,"adjclose":1.940000057220459},{"date":1675434600,"open":1.9199999570846558,"high":1.9600000381469727,"low":1.8899999856948853,"close":1.8899999856948853,"volume":2436500,"adjclose":1.8899999856948853},{"date":1675348200,"open":1.8899999856948853,"high":1.9700000286102295,"low":1.8600000143051147,"close":1.9500000476837158,"volume":3098500,"adjclose":1.9500000476837158},{"date":1675261800,"open":1.850000023841858,"high":1.8799999952316284,"low":1.7999999523162842,"close":1.8600000143051147,"volume":2404800,"adjclose":1.8600000143051147},{"date":1675175400,"open":1.809999942779541,"high":1.899999976158142,"low":1.809999942779541,"close":1.8600000143051147,"volume":2112800,"adjclose":1.8600000143051147},{"date":1675089000,"open":1.840000033378601,"high":1.8799999952316284,"low":1.809999942779541,"close":1.809999942779541,"volume":2866300,"adjclose":1.809999942779541},{"date":1674829800,"open":1.840000033378601,"high":1.9500000476837158,"low":1.7599999904632568,"close":1.850000023841858,"volume":13251900,"adjclose":1.850000023841858},{"date":1674743400,"open":1.8300000429153442,"high":1.8700000047683716,"low":1.7799999713897705,"close":1.809999942779541,"volume":6361500,"adjclose":1.809999942779541},{"date":1674657000,"open":1.75,"high":1.840000033378601,"low":1.7000000476837158,"close":1.7999999523162842,"volume":12055500,"adjclose":1.7999999523162842},{"date":1674570600,"open":1.7999999523162842,"high":1.809999942779541,"low":1.690000057220459,"close":1.75,"volume":9707100,"adjclose":1.75},{"date":1674484200,"open":1.8300000429153442,"high":1.8899999856948853,"low":1.7599999904632568,"close":1.7999999523162842,"volume":7143900,"adjclose":1.7999999523162842},{"date":1674225000,"open":1.8600000143051147,"high":1.9299999475479126,"low":1.7699999809265137,"close":1.8200000524520874,"volume":7837900,"adjclose":1.8200000524520874},{"date":1674138600,"open":1.8200000524520874,"high":1.9199999570846558,"low":1.75,"close":1.840000033378601,"volume":4732000,"adjclose":1.840000033378601},{"date":1674052200,"open":1.940000057220459,"high":2,"low":1.8300000429153442,"close":1.850000023841858,"volume":4346800,"adjclose":1.850000023841858},{"date":1673965800,"open":2.0999999046325684,"high":2.0999999046325684,"low":1.899999976158142,"close":1.9700000286102295,"volume":9215400,"adjclose":1.9700000286102295},{"date":1673620200,"open":1.909999966621399,"high":2.130000114440918,"low":1.909999966621399,"close":2.0899999141693115,"volume":6743200,"adjclose":2.0899999141693115},{"date":1673533800,"open":1.850000023841858,"high":1.9700000286102295,"low":1.7200000286102295,"close":1.9500000476837158,"volume":5145100,"adjclose":1.9500000476837158},{"date":1673447400,"open":1.7799999713897705,"high":1.8600000143051147,"low":1.7000000476837158,"close":1.8200000524520874,"volume":7044700,"adjclose":1.8200000524520874},{"date":1673361000,"open":1.5800000429153442,"high":1.850000023841858,"low":1.5499999523162842,"close":1.7200000286102295,"volume":10291900,"adjclose":1.7200000286102295},{"date":1673274600,"open":1.440000057220459,"high":1.5399999618530273,"low":1.4299999475479126,"close":1.4800000190734863,"volume":2930100,"adjclose":1.4800000190734863},{"date":1673015400,"open":1.3300000429153442,"high":1.4500000476837158,"low":1.309999942779541,"close":1.440000057220459,"volume":5739800,"adjclose":1.440000057220459},{"date":1672929000,"open":1.2300000190734863,"high":1.2799999713897705,"low":1.2100000381469727,"close":1.2599999904632568,"volume":2248200,"adjclose":1.2599999904632568},{"date":1672842600,"open":1.1699999570846558,"high":1.25,"low":1.1699999570846558,"close":1.2400000095367432,"volume":1147400,"adjclose":1.2400000095367432}],"isPending":false,"firstTradeDate":733674600,"id":"","timeZone":{"gmtOffset":-14400},"eventsData":[]}';

        $startDate = 1672842600;
        $endDate   = 1677249000;

        $this->assertIsString($inputData);
        $this->assertIsInt($startDate);
        $this->assertIsInt($endDate);

        Helper::formatDataForTable($inputData, $startDate, $endDate);

        $this->assertIsArray($inputData); //Check if inputData is updated.
        $this->assertNotEmpty($inputData); //Check if input data is not empty.
        $this->assertArrayHasKey(38, $inputData); //Check if input data has an element from response
        $this->assertArrayHasKey(0, $inputData[38]); //Check if updated array is not empty
    }
}
